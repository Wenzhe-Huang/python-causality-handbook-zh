
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>01 - 因果性导论 &#8212; 因果推断：献给求真敢为者</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '01-Introduction-To-Causality';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="02 - 随机实验" href="02-Randomised-Experiments.html" />
    <link rel="prev" title="因果推断：献给求真敢为者" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">因果推断：献给求真敢为者</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    因果推断：献给求真敢为者
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">第一部分 - 阳</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">01 - 因果性导论</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-Randomised-Experiments.html">02 - 随机实验</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-Stats-Review-The-Most-Dangerous-Equation.html">03 - 统计回顾：最危险的方程</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-Graphical-Causal-Models.html">04 - 图形因果模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-The-Unreasonable-Effectiveness-of-Linear-Regression.html">05 - 线性回归的惊人有效性</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-Grouped-and-Dummy-Regression.html">06 - 分组与虚拟变量回归</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-Beyond-Confounders.html">07 - 超越混杂因素</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-Instrumental-Variables.html">08 - 工具变量</a></li>
<li class="toctree-l1"><a class="reference internal" href="09-Non-Compliance-and-LATE.html">09 - 不依从性与局部平均处理效应</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-Matching.html">10 - 匹配法</a></li>
<li class="toctree-l1"><a class="reference internal" href="11-Propensity-Score.html">11 - 倾向得分</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-Doubly-Robust-Estimation.html">12 - 双重稳健估计</a></li>
<li class="toctree-l1"><a class="reference internal" href="13-Difference-in-Differences.html">13 - 双重差分法</a></li>
<li class="toctree-l1"><a class="reference internal" href="14-Panel-Data-and-Fixed-Effects.html">14 - 面板数据与固定效应</a></li>
<li class="toctree-l1"><a class="reference internal" href="15-Synthetic-Control.html">15 - 合成控制法</a></li>
<li class="toctree-l1"><a class="reference internal" href="16-Regression-Discontinuity-Design.html">16 - 断点回归设计</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第二部分 - 阴</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="17-Predictive-Models-101.html">17 - 预测模型入门</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F01-Introduction-To-Causality.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/01-Introduction-To-Causality.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>01 - 因果性导论</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">为什么要学？</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">数据科学今非昔比（或终成其是）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">回答另一类的问题</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">当“相关性”就是“因果性”</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">偏差</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">核心要点</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">参考文献</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">参与贡献</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>01 - 因果性导论<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<section id="id2">
<h2>为什么要学？<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>首先，你可能在想：这对我有什么好处？答案如下：</p>
</section>
<section id="id3">
<h2>数据科学今非昔比（或终成其是）<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>数据科学家被《哈佛商业评论》誉为<a class="reference external" href="https://hbr.org/2012/10/data-scientist-the-sexiest-job-of-the-21st-century">21 世纪最性感的职业</a>。这绝非虚言。十年来，数据科学家一直处于聚光灯下。人工智能专家的<a class="reference external" href="https://www.economist.com/business/2016/04/02/million-dollar-babies">薪资堪比体育巨星</a>。在追逐名利的过程中，数百名年轻专业人士疯狂投身于这场淘金热，只为尽快获得数据科学家的头衔。围绕这股热潮，全新的产业如雨后春笋般涌现。神奇的教学方法声称无需接触数学公式就能让你成为数据科学家。咨询专家们承诺，只要企业能挖掘数据潜力，就能收获百万财富。人工智能或机器学习被称为新时代的电力，而数据则是新石油。</p>
<p>在这一切发生的同时，经济学家们试图解答教育对个人收入的真实影响，生物统计学家们努力探究饱和脂肪是否会增加心脏病发作的概率，心理学家则致力于验证肯定的言语是否真能带来更美满的婚姻。而我们似乎忽略了一点：其实早就有人一直在用“老派”的方式进行数据科学研究。说实话，数据科学并不是一个新领域。我们之所以现在觉得它“新”，只是因为媒体的大肆宣传才让我们如此关注它。</p>
<p>借用 Jim Collins 的一个比喻：想象你正往杯中倒一杯你最喜欢的冰啤酒。若操作得当，杯中绝大部分是酒液，顶部仅浮着一指厚的泡沫层。这杯啤酒恰似数据科学。</p>
<ol class="arabic simple">
<li><p>酒液象征着数据科学的本质——统计学基础、科学探索精神以及对复杂问题的热忱。数百年来，这些核心要素已被证明具有不可估量的价值。</p></li>
<li><p>而泡沫则代表那些建立在虚幻预期之上的浮华之物，终将消散无踪。</p></li>
</ol>
<p>而这层泡沫破灭的速度可能超乎你的想象。正如《The Economist》所言</p>
<blockquote>
<div><p>那些预测人工智能将改变世界的咨询公司，同时也报告称，现实中的企业管理者发现 AI 很难真正落地，市场的热情也正在逐渐降温。研究公司高德纳（Gartner）的斯维特兰娜·西库拉（Svetlana Sicular）表示，2020 年可能是 AI 掉进该公司著名的“炒作周期”下坡阶段的一年。投资者也开始对“随波逐流”的现象保持警惕：风险投资基金 MMC 对欧洲 AI 创业公司的调查发现，有 40% 的公司似乎根本没有在使用任何 AI 技术。</p>
</div></blockquote>
<p>作为数据科学家——或者更准确地说，作为”纯粹”的科学家——我们在这场狂热中应当如何自处？明智之举是首先学会忽略这些泡沫。我们追求的是实质内容。数学与统计学的价值亘古长青，现在也不会例外。其次，要认清真正赋予你工作价值的是核心能力，而非那些尚未被掌握的最新炫目工具。</p>
<p>最后但同样重要的是，请记住学习没有捷径可走。数学与统计学的知识之所以珍贵，恰恰在于其习得之艰难。倘若人人皆能轻易掌握，供过于求必将使其价值贬损。因此，<strong>振作起来</strong>！竭尽所能学好它们。更何况，何乐而不为呢？让我们在这场只属于 <strong>“求真敢为者”</strong> 的旅程中，尽情享受沿途的乐趣吧。</p>
<p><img alt="img" src="_images/tougher-up-cupcake1.jpg" /></p>
</section>
<section id="id4">
<h2>回答另一类的问题<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>当前的机器学习在预测类问题上表现非常出色。正如 Ajay Agrawal、Joshua Gans 和 Avi Goldfarb 在《Prediction Machines》一书中所说的那样：“新一代人工智能并未真正带来‘智能’，而是赋予了我们智能的关键组成部分——预测能力。”我们可以用机器学习做出各种惊艳的应用，但前提是——我们必须将问题表述成一个预测问题：</p>
<ul class="simple">
<li><p>想实现英语到中文的翻译吗？那就构建一个机器学习模型，在输入英语句子时预测对应的中文句子。</p></li>
<li><p>想要识别人脸？那就创建一个机器学习模型，预测图片某部分是否存在人脸。</p></li>
<li><p>想打造一辆自动驾驶汽车？那就用一个机器学习模型，根据车辆周围图像和传感器数据，预测方向盘转向角度及刹车与油门的压力。</p></li>
</ul>
<p>然而，机器学习并非万能良药。在严格界定的范围内，它能创造奇迹；但若数据稍有偏离模型所适应的范围，它也可能惨败。再举《Prediction Machines》中的一个例子：“在许多行业中，低价常与低销量相关联。以酒店业为例，旅游淡季时价格低廉，而需求高峰、酒店爆满时价格则居高不下。基于此类数据，一个天真的预测可能会认为提高价格将带来更多客房销售。”</p>
<p>机器学习在处理这类逆向因果关系的问题上表现尤为糟糕。它们要求我们回答“假设”性问题，经济学家称之为反事实推理。例如：</p>
<ul class="simple">
<li><p>如果我现在为商品标价时采用另一个价格，结果会怎样？</p></li>
<li><p>如果我选择低糖饮食而非目前的低脂饮食，又会发生什么？</p></li>
<li><p>如果我在银行工作，放贷时改变客户筛选标准，会对收益有何影响？</p></li>
<li><p>如果我是地方政府官员，怎样才能改进教育体系？是要每个孩子配备一台平板？还是应该建设一座传统图书馆？</p></li>
</ul>
<p>这些问题背后，都隐藏着我们真正想要解答的因果问题。因果问题不仅存在于商业决策中（如如何提高销量），也贯穿于我们每个人关心的生活命题：</p>
<ul class="simple">
<li><p>上名校是否真的有助于我获得更高收入？（教育是否导致更高的收入？）</p></li>
<li><p>移民是否会影响我找工作的机会？（移民是否导致失业率上升？）</p></li>
<li><p>给穷人发放现金是否能降低犯罪率？</p></li>
</ul>
<p>无论身处何种领域，你很可能已经或终将需要回答某种类型的因果问题。遗憾的是，对机器学习而言，我们无法依赖相关性预测来解决这类问题。回答这类问题比多数人想象的更具挑战性。你的父母可能反复告诫你”相关不等于因果”，”相关不等于因果”。但事实上，解释其中缘由需要更深入的探讨。</p>
<p>而这，正是本书开篇要探讨的主题。至于本书接下来的章节，将致力于探索如何使相关转化为因果。</p>
</section>
<section id="id5">
<h2>当“相关性”就是“因果性”<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>从直觉上讲，我们其实大致知道为什么相关性不能等同于因果性。</p>
<p>如果有人告诉你：“那些给学生配发平板的学校，表现普遍比没配平板的学校更好”，你可能很快就会反驳：有可能这些发得起平板的学校本身就更富裕。</p>
<p>因此，即使不发平板，他们的学生可能也比平均水平表现更好。</p>
<p>正因如此，我们不能断定“在课堂上给学生发平板会提高学习成绩”；我们只能说“发平板”这件事和“更高的成绩”在数据上存在相关性。比如在巴西，可以通过 ENEM 成绩来衡量：</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">expit</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">style</span>

<span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;fivethirtyeight&quot;</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">tuition</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
<span class="n">tablet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">expit</span><span class="p">((</span><span class="n">tuition</span> <span class="o">-</span> <span class="n">tuition</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">tuition</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">enem_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">200</span> <span class="o">-</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">tablet</span> <span class="o">+</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">tuition</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">enem_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">enem_score</span> <span class="o">-</span> <span class="n">enem_score</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="n">enem_score</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">enem_score</span> <span class="o">*=</span> <span class="mi">1000</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">enem_score</span><span class="o">=</span><span class="n">enem_score</span><span class="p">,</span> <span class="n">Tuition</span><span class="o">=</span><span class="n">tuition</span><span class="p">,</span> <span class="n">Tablet</span><span class="o">=</span><span class="n">tablet</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;enem_score&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Tablet&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ENEM score by Tablet in Class&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/cf5e4820da919e6e0cfa5aa741ce3b83a1d04ad4090a4d7f6a0bfc11ea2ba172.png" src="_images/cf5e4820da919e6e0cfa5aa741ce3b83a1d04ad4090a4d7f6a0bfc11ea2ba172.png" />
</div>
</div>
<p>为了超越简单的直觉，我们首先建立一些符号体系。这将是我们讨论因果关系的日常语言——把它当作我们这些“求真敢为者”的通用语，在未来一次次关于因果推断的战斗中，我们会用这套语言彼此辨识、并高声呐喊。</p>
<p>我们把 <span class="math notranslate nohighlight">\(T_i\)</span> 定义为为单位 i 是否接受处理（treatment）的变量。</p>
<p><span class="math notranslate nohighlight">\(
T_i=\begin{cases}
1 \ \text{如果单位i接受了处理}\\
0 \ \text{否则}\\
\end{cases}
\)</span></p>
<p>此处所说的“处理”指的是我们希望探究其效果的某种干预措施的术语。在本例中，该处理即为向学生发放平板电脑。（注：有时你也可能会看到用<span class="math notranslate nohighlight">\(D\)</span>来表示处理，而不是<span class="math notranslate nohighlight">\(T\)</span>。）</p>
<p>接下来，我们用 <span class="math notranslate nohighlight">\(Y_i\)</span> 表示单元 i 的观测结果变量。</p>
<p>这个结果变量就是我们关注的核心。我们希望了解的是：处理是否对结果有影响。以“平板教学”为例，这个结果就是学生的学业表现。</p>
<p>这时，问题开始变得有趣起来。因果推断的根本问题在于，<strong>我们永远无法同时观察同一单位接受处理与未接受处理的两种状态下的结果</strong>。这就像面前有两条分岔的道路，而我们只能知晓所选之路的前方风景。正如罗伯特·弗罗斯特（Robert Frost）在他的诗中所写：</p>
<blockquote>
<div><p>两条小路分岔在金黄的树林中，<br />
可惜我不能同时踏上两条，<br />
我站了很久，<br />
沿着其中一条望去，直到它在林中转弯，消失不见。</p>
</div></blockquote>
<p>为了真正理解这个问题，我们将频繁使用 <strong>潜在结果</strong>这一概念进行讨论。</p>
<p>它们之所以称为潜在，是因为它们实际上并未发生，而是代表了在采取某种干预措施后 <strong>可能发生的情况</strong>。我们有时将实际发生的潜在结果称为事实性结果，而未发生的则称为反事实结果。</p>
<p>关于符号，我们引入一个额外的下标：</p>
<p><span class="math notranslate nohighlight">\(Y_{0i}\)</span> 表示未接受处理时单元 i 的潜在结果。</p>
<p><span class="math notranslate nohighlight">\(Y_{1i}\)</span> 表示 <strong>同一单元 i</strong>在接受处理后的潜在结果。</p>
<p>有时潜在结果可能以函数形式表示为 <span class="math notranslate nohighlight">\(Y_i(t)\)</span>，需注意区分。 <span class="math notranslate nohighlight">\(Y_{0i}\)</span> 可能是 <span class="math notranslate nohighlight">\(Y_i(0)\)</span> ，而 <span class="math notranslate nohighlight">\(Y_{1i}\)</span> 可能是 <span class="math notranslate nohighlight">\(Y_i(1)\)</span>。本文多数情况下将采用下标表示法。</p>
<p><img alt="img" src="_images/potential_outcomes.png" /></p>
<p>回到我们的例子，</p>
<p>如果学生 i 所在的教室使用了平板电脑，那么<span class="math notranslate nohighlight">\(Y_{1i}\)</span>就表示他的学业表现。无论实际情况如何，这对<span class="math notranslate nohighlight">\(Y_{1i}\)</span>并无影响，结果始终相同。如果学生 i 确实拿到了平板，我们就能观测到<span class="math notranslate nohighlight">\(Y_{1i}\)</span>；如果没有拿到，我们观测到的是<span class="math notranslate nohighlight">\(Y_{0i}\)</span>。</p>
<p>请注意：即便我们没有观测到<span class="math notranslate nohighlight">\(Y_{1i}\)</span>，它依然是“存在”的——只是我们无法看到。这种我们看不到但理论上存在的潜在结果，就被称为“反事实潜在结果”（counterfactual potential outcome）。</p>
<p>在定义了潜在结果之后，我们就可以写出个体处理效应：</p>
<p><span class="math notranslate nohighlight">\(Y_{1i} - Y_{0i}\)</span></p>
<p>当然，由于“因果推断的基本难题”（只能观测其中一个潜在结果），我们永远无法直接知道某个个体的处理效应。所以，与其去估计每个个体的因果效应，不如转而去估计一个更容易的量：<strong>平均处理效应（Average Treatment Effect, ATE）</strong>：</p>
<p><span class="math notranslate nohighlight">\(ATE = E[Y_1 - Y_0]\)</span></p>
<p>其中， <code class="docutils literal notranslate"><span class="pre">E[...]</span></code> 表示期望值。另一个更易估计的量是<strong>对已接受处理者的平均处理效应（Average Treatment Effect on the Treated, ATT）</strong>：</p>
<p><span class="math notranslate nohighlight">\(ATT = E[Y_1 - Y_0 | T=1]\)</span></p>
<p>虽然我们无法同时看到两种潜在结果，但为了讨论方便，假设我们能够做到。假设因果推断之神被我们在统计战役中英勇奋斗的精神所感动，赐予我们如神般洞察潜在替代结果的能力。凭借此力，假设我们收集了 4 所学校的数据，知晓它们是否向学生提供平板电脑及其在年度学术测试中的成绩。此处，平板电脑即处理变量，故 <span class="math notranslate nohighlight">\(T=1\)</span> 表示学校向学生提供平板电脑，<span class="math notranslate nohighlight">\(Y\)</span> 则为测试成绩。</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">i</span><span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
    <span class="n">Y0</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">700</span><span class="p">],</span>
    <span class="n">Y1</span><span class="o">=</span><span class="p">[</span><span class="mi">450</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">750</span><span class="p">],</span>
    <span class="n">T</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">Y</span><span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">750</span><span class="p">],</span>
    <span class="n">TE</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>i</th>
      <th>Y0</th>
      <th>Y1</th>
      <th>T</th>
      <th>Y</th>
      <th>TE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>500</td>
      <td>450</td>
      <td>0</td>
      <td>500</td>
      <td>-50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>600</td>
      <td>600</td>
      <td>0</td>
      <td>600</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>800</td>
      <td>600</td>
      <td>1</td>
      <td>600</td>
      <td>-200</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>700</td>
      <td>750</td>
      <td>1</td>
      <td>750</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>这里的 <span class="math notranslate nohighlight">\(ATE\)</span> 就是最后一列的平均值，即处理效应的平均值：</p>
<p><span class="math notranslate nohighlight">\(ATE=(-50 + 0 - 200 + 50)/4 = -50\)</span></p>
<p>这意味着平板电脑平均使学生的学业成绩降低了50分。此处的 <span class="math notranslate nohighlight">\(ATT\)</span> 将是当 <span class="math notranslate nohighlight">\(T=1\)</span> 时最后一列的平均值:</p>
<p><span class="math notranslate nohighlight">\(ATT=(- 200 + 50)/2 = -75\)</span></p>
<p>这表明，对于接受处理的学校，平板电脑平均使学生的学业成绩降低了 75 分。当然，我们永远无法确知这一点。实际上，上表将呈现如下情况：</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">i</span><span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
    <span class="n">Y0</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
    <span class="n">Y1</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">750</span><span class="p">],</span>
    <span class="n">T</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">Y</span><span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">750</span><span class="p">],</span>
    <span class="n">TE</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>i</th>
      <th>Y0</th>
      <th>Y1</th>
      <th>T</th>
      <th>Y</th>
      <th>TE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>500.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>500</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>600.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>600</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>NaN</td>
      <td>600.0</td>
      <td>1</td>
      <td>600</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>NaN</td>
      <td>750.0</td>
      <td>1</td>
      <td>750</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>你或许会说，这显然不够理想，但我难道不能计算处理组的均值并与未处理组的均值进行比较吗？换言之，难道不能直接进行 <span class="math notranslate nohighlight">\(ATE=(600+750)/2  - (500 + 600)/2  = 125\)</span> 操作吗？答案是不行！请注意结果差异之大。你已犯下将相关误认为因果的最严重错误。要理解其中缘由，让我们深入探究因果推断的主要敌人。</p>
</section>
<section id="id6">
<h2>偏差<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<p>偏差正是使“相关性 ≠ 因果性”的关键原因。</p>
<p>幸运的是，凭借直觉我们就能轻松理解它。让我们回顾课堂平板电脑的案例。当面对”提供平板电脑的学校学生成绩更优异”这一论断时，我们可以反驳说，这些学校即便没有平板电脑，成绩可能依然更高。因为它们很可能比其他学校资金更充裕，从而能聘请更优秀的教师、提供更好的教室设施等。换言之，问题在于接受处理（配备平板电脑）的学校与未接受处理的学校根本不具备可比性。</p>
<p>如果我们用“潜在结果”的符号来表达这一点：<strong>接受处理的学校的 <span class="math notranslate nohighlight">\(Y_0\)</span></strong>（即如果它们没发平板时的成绩）与 <strong>未接受处理学校的<span class="math notranslate nohighlight">\(Y_0\)</span></strong>（真实的无平板成绩）是不同的。要记住，处理组的 <span class="math notranslate nohighlight">\(Y_0\)</span> 是反事实（counterfactual），我们无法观察到它，只能推理它。在这个特定案例中，我们可以依靠现实经验进一步推理。我们有理由相信，处理组的<span class="math notranslate nohighlight">\(Y_0\)</span>本来就比未处理组的<span class="math notranslate nohighlight">\(Y_0\)</span>更高。因为能给学生配平板的学校，也往往有其他资源，这些都会促成更高的成绩。让我们停下来消化一下这点，理解“潜在结果”概念需要时间。请重读本段并确保理解其含义。</p>
<p>有了这个基础，我们可以用一个基本的数学公式来展示为何相关不等于因果。相关性的计算方式是 <span class="math notranslate nohighlight">\(E[Y|T=1] - E[Y|T=0]\)</span>，在我们的例子中，这表示拥有平板电脑的学校平均测试分数减去没有平板电脑的学校平均测试分数。而因果关系的正确计算方式是 <span class="math notranslate nohighlight">\(E[Y_1 - Y_0]\)</span>。</p>
<p>我们现在来分析“相关性指标”，并将其中的观测结果替换成潜在结果，以探究它们之间是如何联系的。对于接受处理的个体，观察到的结果是 <span class="math notranslate nohighlight">\(Y_1\)</span>；而对于未接受处理的个体，观察到的结果则是 <span class="math notranslate nohighlight">\(Y_0\)</span>。</p>
<p><span class="math notranslate nohighlight">\(
E[Y|T=1] - E[Y|T=0] = E[Y_1|T=1] - E[Y_0|T=0]
\)</span></p>
<p>现在，让我们对 <span class="math notranslate nohighlight">\(E[Y_0|T=1]\)</span>进行加减运算。这是一个反事实结果，它揭示了如果接受处理的个体未接受处理，其原本可能的结果会是什么。</p>
<p><span class="math notranslate nohighlight">\(
E[Y|T=1] - E[Y|T=0] = E[Y_1|T=1] - E[Y_0|T=0] + E[Y_0|T=1] - E[Y_0|T=1]
\)</span></p>
<p>最后，我们重新排列各项，合并部分期望值，于是乎结果显而易见：</p>
<p><span class="math notranslate nohighlight">\(
E[Y|T=1] - E[Y|T=0] = \underbrace{E[Y_1 - Y_0|T=1]}_{ATT} + \underbrace{\{ E[Y_0|T=1] - E[Y_0|T=0] \}}_{BIAS}
\)</span></p>
<p>这段简单的数学涵盖了我们在因果问题中遇到的所有难题。我无法强调你理解它的每一个方面有多么重要。如果你被迫要在手臂上纹点什么，这个方程应该是个不错的选择。它值得你珍视并理解其传达的信息，就像可以百般解读的圣典。事实上，让我们更深入地探讨一下。我们将其分解，看看其中的一些含义。首先，这个方程说明了为什么相关不等于因果。如我们所见，相关性等于处理组效应加上一个偏差项。偏差来源于处理组和对照组在处理前就存在的差异，假设两者均未接受处理。现在，当有人告诉我们课堂上的平板电脑能提高学业成绩时，我们可以明确指出为何持怀疑态度。我们认为，在这个例子中，<span class="math notranslate nohighlight">\(E[Y_0|T=0] &lt; E[Y_0|T=1]\)</span>，即那些有能力为孩子提供平板电脑的学校本身就比无力提供的学校更好，与是否使用平板电脑无关。</p>
<p>为何会出现这种情况？待我们深入讨论混杂因素时将进一步阐述，但此刻你可以理解为偏差的产生源于许多我们无法控制的因素与处理同时发生变化。因此，接受与未接受平板电脑教学的学校不仅在设备配置上存在差异，还在学费成本、地理位置、师资力量等方面有所不同。要断言课堂平板电脑能提升学业表现，我们需要确保这两类学校在其他条件上平均而言是相似的。</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Tuition&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;enem_score&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Tablet&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ENEM score by Tuition Cost&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/02cfdff4f5e509ec798cfd4797f6f334d6ed17b7ce2aa040368b38d59280586e.png" src="_images/02cfdff4f5e509ec798cfd4797f6f334d6ed17b7ce2aa040368b38d59280586e.png" />
</div>
</div>
<p>既然我们已经理解了问题所在，现在让我们来看看解决方案。我们还可以探讨要使相关等同于因果所需满足的条件。<strong>若 <span class="math notranslate nohighlight">\(E[Y_0|T=0] = E[Y_0|T=1]\)</span>，那么相关即等同于因果！</strong> 理解这一点不仅仅是记住这个等式，其背后还有着强有力的直观论证。称 <span class="math notranslate nohighlight">\(E[Y_0|T=0] = E[Y_0|T=1]\)</span> 意味着处理组与对照组在处理前具有可比性。或者说，当被处理者未接受处理时，若能观测到其 <span class="math notranslate nohighlight">\(Y_0\)</span>，其结果将与未处理者相同。从数学上看，偏差项将因此消失：</p>
<p><span class="math notranslate nohighlight">\(
E[Y|T=1] - E[Y|T=0] = E[Y_1 - Y_0|T=1] = ATT
\)</span></p>
<p>此外，若处理组与未处理组仅在处理本身存在差异，则 <span class="math notranslate nohighlight">\(E[Y_0|T=0] = E[Y_0|T=1]\)</span>，此时处理组所受的因果影响与未处理组相同（因为两者极为相似）。</p>
<p><span class="math notranslate nohighlight">\(
\begin{align}
E[Y_1 - Y_0|T=1] &amp;= E[Y_1|T=1] - E[Y_0|T=1] \\
&amp;= E[Y_1|T=1] - E[Y_0|T=0] \\
&amp;= E[Y|T=1] - E[Y|T=0]
\end{align}
\)</span></p>
<p>在此情况下，<strong>均值差异即成为因果效应</strong>：</p>
<p><span class="math notranslate nohighlight">\(
E[Y|T=1] - E[Y|T=0] = ATT
\)</span></p>
<p>此外，若处理组与未处理组仅在干预措施本身存在差异，我们同样满足 <span class="math notranslate nohighlight">\(E[Y_1|T=0] = E[Y_1|T=1]\)</span>条件，即确保两组对干预的反应相似。此时，处理组与未处理组不仅在干预前可互换，干预后亦保持可互换性。这种情况下， <span class="math notranslate nohighlight">\(E[Y_1 - Y_0|T=1]=E[Y_1 - Y_0|T=0]\)</span> 且</p>
<p><span class="math notranslate nohighlight">\(
E[Y|T=1] - E[Y|T=0] = ATT = ATE
\)</span></p>
<p>鉴于其重要性，我认为有必要通过直观图示再次阐释。若对处理组与未处理组进行简单均值比较（蓝点代表未接受干预组，即未使用平板电脑），结果如下：</p>
<p><img alt="img" src="_images/anatomy1.png" /></p>
<p>需注意两组结果差异可能源于两个因素：</p>
<ol class="arabic simple">
<li><p>处理效果：考试成绩的提高源于给孩子们提供了平板电脑。</p></li>
<li><p>测试成绩的部分差异可归因于优质教育的高昂学费。在此情境下，接受处理与未接受处理的群体之所以不同，是因为前者承担了显著更高的学费成本。而处理组与对照组之间的其他差异并非由处理本身引起。</p></li>
</ol>
<p>个体处理效应是指某单元的实际结果与其在假设接受另一种处理时可能产生的理论结果之间的差异。唯有具备如神明般观测潜在结果的能力（如下方左图所示），我们才能获知真实的处理效应。这些反事实结果以浅色标识。</p>
<p><img alt="img" src="_images/anatomy2.png" /></p>
<p>右图中展示了先前讨论的偏差现象。当强制所有个体不接受处理时，我们仅能观察到 <span class="math notranslate nohighlight">\(T_0\)</span> 潜在结果，此时偏差便显现出来。通过比较处理组与对照组的差异可以发现：若二者存在系统性差异，则说明存在非处理因素导致两组分化。这种干扰因素即为偏差，它会掩盖真实的处理效应。</p>
<p>现在，将此与一个无偏差的假设情境进行对比。假设平板电脑是随机分配给学校的。在这种情况下，富裕学校和贫困学校获得干预的机会均等。干预措施将在学费分布范围内得到良好分配。</p>
<p><img alt="img" src="_images/anatomy3.png" /></p>
<p>在此情形下，接受干预与未接受干预群体间的结果差异即为平均因果效应。这是因为除了干预本身外，干预组与对照组之间不存在其他差异来源。我们观察到的所有差异都必须归因于此。换言之，这种情况下不存在偏差。</p>
<p><img alt="img" src="_images/anatomy4.png" /></p>
<p>若设定所有人均不接收干预，仅观察 <span class="math notranslate nohighlight">\(Y_0\)</span>状态，我们将发现干预组与对照组之间不存在差异。</p>
<p>这正是因果推断所致力于解决的艰巨任务。其核心在于寻找巧妙方法消除偏差，使处理组与未处理组具有可比性，从而确保我们所观察到的差异仅反映平均处理效应。归根结底，因果推断旨在拨开所有错觉与误读的迷雾，揭示世界运行的真相。既然我们已经理解这一点，现在就可以继续掌握那些消除偏差的最有力方法——这些”求真敢为者”的武器，来识别因果效应。</p>
</section>
<section id="id7">
<h2>核心要点<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<p>到目前为止，我们已经知道了：相关性 ≠ 因果性。</p>
<p>更重要的是，我们也准确理解了为什么不等同，以及如何让相关性接近因果性。</p>
<p>我们引入了“潜在结果（potential outcomes）”的符号，作为理解因果推理的核心工具。借助它，我们学会了把统计学问题看作两个可能的现实：一个是接受处理的现实，另一个则是不接受处理的现实。但遗憾的是，我们每次只能观测其中一个现实，这正是因果推断的根本难题所在。</p>
<p>接下来，我们将学习几种基本的估计因果效应的方法，
从最经典、也最可靠的手段——<strong>随机实验（Randomized Trial）</strong> 开始。</p>
<p>在此过程中，我也会穿插回顾一些统计学基础概念。</p>
<p>最后，我想用一句常出现在因果推断课堂上的台词作为收尾，
它出自一部功夫剧：</p>
<blockquote>
<div><p>“一个人的命运，早已写好。人只能顺着命运走完这一生。” —— 凯恩（Caine）<br />
“是的，但每个人又的确可以选择如何生活。
虽然这两句话看似矛盾，却都是真理。”
—— Old Man</p>
</div></blockquote>
</section>
<section id="id8">
<h2>参考文献<a class="headerlink" href="#id8" title="Link to this heading">#</a></h2>
<p>我愿将这一系列作品视为对 Joshua Angrist、Alberto Abadie 和 Christopher Walters 杰出计量经济学课程的致敬。第一部分的大部分思想源自他们在美国经济学会授课的内容。在艰难的 2020 年，正是观看他们的课程视频让我保持了理智。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.aeaweb.org/conference/cont-ed/2017-webcasts">Cross-Section Econometrics</a></p></li>
<li><p><a class="reference external" href="https://www.aeaweb.org/conference/cont-ed/2020-webcasts">Mastering Mostly Harmless Econometrics</a></p></li>
</ul>
<p>我还想引用 Angrist 的精彩著作。它们向我展示了计量经济学（他们称之为“Metrics”）不仅极为实用，而且充满乐趣。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.mostlyharmlesseconometrics.com">Mostly Harmless Econometrics</a></p></li>
<li><p><a class="reference external" href="https://www.masteringmetrics.com">Mastering ‘Metrics</a></p></li>
</ul>
<p>最后还要感谢 Miguel Hernán 和 Jamie Robins 的<a class="reference external" href="https://hsph.harvard.edu/profile/miguel-hernan/">《Causal Inference》</a>一书。它是我在面对最棘手的因果问题时的可靠伙伴。</p>
<p><img alt="img" src="_images/poetry.png" /></p>
</section>
<section id="id9">
<h2>参与贡献<a class="headerlink" href="#id9" title="Link to this heading">#</a></h2>
<p><strong>《Causal Inference for the Brave and True》</strong> 是一本关于因果推断的开源教材，致力于以经济上可负担、认知上可理解的方式，普及这门“科学的统计基础”。全书基于 Python，仅使用自由开源软件编写，原始英文版本由 <a class="reference external" href="https://github.com/matheusfacure">Matheus Facure</a> 编写与维护。</p>
<p>本书的中文版由黄文喆与许文立教授合作翻译，并托管在 <a class="reference external" href="https://github.com/Wenzhe-Huang/python-causality-handbook-zh">GitHub 中文主页</a>。希望本地化的内容能帮助更多中文读者学习和掌握因果推断方法。</p>
<p>如果你觉得这本书对你有帮助，并希望支持该项目，可以前往 <a class="reference external" href="https://www.patreon.com/causal_inference_for_the_brave_and_true">Patreon</a> 支持原作者。</p>
<p>如果你暂时不方便进行经济支持，也可以通过以下方式参与贡献：</p>
<ul class="simple">
<li><p>修正错别字</p></li>
<li><p>提出翻译或表达建议</p></li>
<li><p>反馈你未能理解的部分内容</p></li>
</ul>
<p>欢迎前往英文版或中文版仓库点击 <a class="reference external" href="https://github.com/matheusfacure/python-causality-handbook/issues">issues 区</a> 或 <a class="reference external" href="https://github.com/Wenzhe-Huang/python-causality-handbook-zh/issues">中文版 issues 区</a> 提出反馈。</p>
<p>最后，如果你喜欢这本书的内容，也请将其分享给可能感兴趣的朋友，并为项目在 GitHub 上点亮一颗星：<a class="reference external" href="https://github.com/matheusfacure/python-causality-handbook">英文版仓库</a> / <a class="reference external" href="https://github.com/Wenzhe-Huang/python-causality-handbook-zh">中文版仓库</a>。</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">因果推断：献给求真敢为者</p>
      </div>
    </a>
    <a class="right-next"
       href="02-Randomised-Experiments.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">02 - 随机实验</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">为什么要学？</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">数据科学今非昔比（或终成其是）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">回答另一类的问题</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">当“相关性”就是“因果性”</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">偏差</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">核心要点</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">参考文献</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">参与贡献</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Matheus Facure
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>