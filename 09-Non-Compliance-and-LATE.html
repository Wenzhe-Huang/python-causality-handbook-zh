
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>09 - 不依从性与局部平均处理效应 &#8212; 因果推断：献给求真敢为者</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '09-Non-Compliance-and-LATE';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="10 - 匹配法" href="10-Matching.html" />
    <link rel="prev" title="08 - 工具变量" href="08-Instrumental-Variables.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">因果推断：献给求真敢为者</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    因果推断：献给求真敢为者
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">第一部分 - 阳</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-Introduction-To-Causality.html">01 - 因果性导论</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-Randomised-Experiments.html">02 - 随机实验</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-Stats-Review-The-Most-Dangerous-Equation.html">03 - 统计回顾：最危险的方程</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-Graphical-Causal-Models.html">04 - 图形因果模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-The-Unreasonable-Effectiveness-of-Linear-Regression.html">05 - 线性回归的惊人有效性</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-Grouped-and-Dummy-Regression.html">06 - 分组与虚拟变量回归</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-Beyond-Confounders.html">07 - 超越混杂因素</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-Instrumental-Variables.html">08 - 工具变量</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">09 - 不依从性与局部平均处理效应</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-Matching.html">10 - 匹配法</a></li>
<li class="toctree-l1"><a class="reference internal" href="11-Propensity-Score.html">11 - 倾向得分</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-Doubly-Robust-Estimation.html">12 - 双重稳健估计</a></li>
<li class="toctree-l1"><a class="reference internal" href="13-Difference-in-Differences.html">13 - 双重差分法</a></li>
<li class="toctree-l1"><a class="reference internal" href="14-Panel-Data-and-Fixed-Effects.html">14 - 面板数据与固定效应</a></li>
<li class="toctree-l1"><a class="reference internal" href="15-Synthetic-Control.html">15 - 合成控制法</a></li>
<li class="toctree-l1"><a class="reference internal" href="16-Regression-Discontinuity-Design.html">16 - 断点回归设计</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第二部分 - 阴</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="17-Predictive-Models-101.html">17 - 预测模型入门</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F09-Non-Compliance-and-LATE.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/09-Non-Compliance-and-LATE.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>09 - 不依从性与局部平均处理效应</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">初探异质性世界</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#late">局部平均处理效应（LATE）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">对参与度的影响</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">核心要点</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">参考文献</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">参与贡献</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>09 - 不依从性与局部平均处理效应<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<section id="id2">
<h2>初探异质性世界<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>此前，我们以更为传统的视角审视了工具变量（IV）。它被视为一种可利用的自然实验。而现代工具变量实践则大量借鉴了医学的观点，根据个体对工具变量的响应方式，将世界划分为四种类型的测试者。</p>
<ol class="arabic simple">
<li><p>依从者</p></li>
<li><p>永不接受者</p></li>
<li><p>总是接受者</p></li>
<li><p>违抗者</p></li>
</ol>
<p>这一命名源自药物科学。设想你正在进行一项实验，测试某种新药对某种疾病的效果。每位测试者被分配到一种治疗方式：药物或安慰剂。依从者是指那些严格遵循分配方案的测试者——若分配到安慰剂则服用安慰剂，若分配到药物则服用药物。永不接受者则是那些拒绝服用药物的测试者，即使被分配了新药也拒不服用。而总是接受者则能通过某种方式获取新药，即便他们被分配的是安慰剂。最后，违抗者是指那些被分配到对照组却接受治疗、被分配到治疗组却选择对照的人，可以将其想象成总是与指令对着干的顽童。实际上，这类情况（指违抗者，而非孩童）并不常见，因此我们通常会忽略他们。</p>
<p><img alt="img" src="_images/defiers.png" /></p>
<p>现代工具变量法将工具视为准实验设计，其中依从性并不完美。通过这种方式，它区分了内部有效与外部有效的因果效应。提醒一下，内部有效效应是我们能够识别的效应，在特定数据和环境下是有效的。在工具变量法中，这指的是那些因工具而改变处理的个体的处理效应。另一方面，外部有效性关注的是该因果效应的预测能力，即我们能否将从样本中发现的效应推广到其他群体。例如，假设你在大学里进行了一项随机对照试验，以探究人们在有捐赠激励时是否慷慨。实验设计良好，但仅邀请经济学学生参与。结果发现他们全是自私的家伙。这是内部有效的结论，对那组数据点有效。但你能从该实验推断出人类本性自私吗？这几乎不可能。因此，我们会质疑你的实验是否具备将其结果推广的外部有效性。言归正传，回到工具变量法。</p>
<p>为了更具体地说明，让我们考虑一个你想通过应用内购买提升用户参与度的案例。实现这一目标的一种方法，是要求你的市场营销部门设计一条推送消息来吸引用户。他们提出了一个绝妙的设计和非常精致的用户互动方案。基于这条推送，你着手设计一项随机试验。你随机选取了 10000 名客户，并给每个人分配了 50%的概率接收这条推送。然而，在执行测试时，你注意到一些被分配接收推送的客户实际上并未收到。当你与工程师沟通时，他们解释说，这可能是因为这些客户使用的是较旧的手机，不支持营销团队设计的那种推送功能。</p>
<p>起初，你可能认为这没什么大不了的。你可以直接使用实际接收到的处理作为处理变量，而不是使用分配的处理，对吧？但事实证明事情并不那么简单。如果你绘制整个情况的因果图，它看起来会像这样：</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">style</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">smf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">linearmodels.iv</span><span class="w"> </span><span class="kn">import</span> <span class="n">IV2SLS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphviz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gr</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;fivethirtyeight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Digraph</span><span class="p">()</span>

<span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;push assigned&quot;</span><span class="p">,</span> <span class="s2">&quot;push delivered&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;push delivered&quot;</span><span class="p">,</span> <span class="s2">&quot;in app purchase&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="s2">&quot;in app purchase&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="s2">&quot;push delivered&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">g</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/719a1b00d5325d163d995caf40d8155e2192b23a0a920b7d56cd707bcf18fad7.svg" src="_images/719a1b00d5325d163d995caf40d8155e2192b23a0a920b7d56cd707bcf18fad7.svg" /></div>
</div>
<p>在因果图的上游，是推送分配环节。这一设计本身具有随机性，因此不存在任何前因影响。接着，有一个节点表示推送是否成功送达。并非所有被分配接收推送的用户都能实际收到，此处存在不依从情况。更具体地说，存在”永不接受者”：即使被分配接受干预也始终未获处理的人群。且有理由认为这种不依从并非偶然——由于使用老旧手机的用户往往无法接收推送，可以论证收入水平也影响着推送送达率。用户越富裕，拥有高性能手机的可能性越高，进而接收推送的概率也越大。最后是结果变量，即应用内购买行为。需注意我们无法观测收入数据，故无法对其进行控制。基于此背景，让我们分别考察以下两种处理方式的影响：以推送分配作为处理变量，与以实际推送送达作为处理变量。</p>
<p>第一种情况下，我们将通过以下均值差分来估计因果效应：</p>
<p><span class="math notranslate nohighlight">\(
ATE = E[Y | pushAssigned=1] - E[Y | pushAssigned=0]
\)</span></p>
<p>正如我们目前所深刻认识到的，只有当偏误 <span class="math notranslate nohighlight">\(E[Y_1] - E[Y_0]\)</span> 为零时，这才是对 <span class="math notranslate nohighlight">\(E[Y_0|pushAssigned=0] - E[Y_0|pushAssigned=1]\)</span> 的无偏估计。由于 <code class="docutils literal notranslate"><span class="pre">pushAssigned</span></code> 是随机的，我们知道偏误为零。那么问题就此解决了吗？并非完全如此。要知道，如果我们这样做，实际上是在回答一个与我们初衷不同的问题。我们将找到的是<strong>处理分配而非处理本身的因果效应</strong>。但它们是否不同，或者我们能否将处理分配的因果效应外推至平均处理效应（ATE）？换言之，处理分配的因果效应是否是对 ATE 的无偏估计？</p>
<p>事实证明，并非如此。由于不依从性，被分配到处理组的个体的结果会向对照组的结果方向偏移。不依从性无意中反转了处理，使得处理组和对照组在结果上更为相似。请不要将此与变量上的相似性混淆。我们希望处理组和对照组在变量上相似，这将使它们具有可比性。我们不希望的是，如果确实存在处理效果，它们在结果上却表现相似。</p>
<p>要理解这一点，首先假设我们有总是接受者。其中一些人会随机被分配到对照组。但即便如此，他们仍会接受处理。这使得他们本质上成为与对照组混杂的处理群体。由于这种混杂，当我们遇到不依从情况时，因果效应将更难被发现。</p>
<p><img alt="img" src="_images/always_takers.png" /></p>
<p>同理，永不接受者会使那些被分配到处理组的人看起来有点像未接受处理的人，因为他们即使被分配到处理组也不会接受处理。从这个意义上说，处理分配的因果效应偏向于零，因为不依从性缩小了可检测到的影响。另一种理解方式是设想一个极端情况。假设不依从性非常高。处理分配与处理接受无关。在这种情况下，处理接受完全是随机的。用工具变量的术语来说，这意味着我们有一个非常弱的第一阶段。用 Z 表示处理分配，我们将得到</p>
<p><span class="math notranslate nohighlight">\(
E[Y|Z=1] - E[Y|Z=0] = 0
\)</span></p>
<p>处理分配与结果之间将不再存在因果联系。Z 将只是一个毫无意义的随机变量漂浮在那里。</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Digraph</span><span class="p">()</span>

<span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;push assigned&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;push delivered&quot;</span><span class="p">,</span> <span class="s2">&quot;in app purchase&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="s2">&quot;in app purchase&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="s2">&quot;push delivered&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">g</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/4dbcb641ad6c77730c4baf4786ed9884e18b1151b9a0f300a557a9662f791965.svg" src="_images/4dbcb641ad6c77730c4baf4786ed9884e18b1151b9a0f300a557a9662f791965.svg" /></div>
</div>
<p>好吧，我们已经排除了使用分配的因果效应来估计处理的因果效应。那么，直接使用实际接受的处理来做估计怎么样？</p>
<p><span class="math notranslate nohighlight">\(
\mathrm{ATE} = E[Y | \mathrm{push}=1] - E[Y | \mathrm{push}=0]
\)</span></p>
<p>再次，我们需要思考这是否存在偏误，或者是否 <span class="math notranslate nohighlight">\(E[Y_0|\mathrm{push}=0] = E[Y_0|\mathrm{push}=1]\)</span>。仅通过观察上方的因果图，我们就知道情况并非如此。那个未测量的混杂因素——收入，潜伏在周围，肯定会把事情搞砸。正如我们之前所说，推送失败在我们的案例中是由客户使用旧手机引起的。这意味着我们很可能 <span class="math notranslate nohighlight">\(E[Y_0|\mathrm{push}=0] &lt; E[Y_0|\mathrm{push}=1]\)</span>。我们认为情况如此，因为资金较少的客户既拥有更旧的手机，这将导致 <span class="math notranslate nohighlight">\(\mathrm{push}=0\)</span> ，同时也降低了应用内购买的可能性 <span class="math notranslate nohighlight">\(Y_0\)</span>。</p>
<p>真糟糕！我们既不能用分配的处理，也不能用实际接受的处理来估计我们的平均处理效应（ATE）。但幸运的是，我们知道可以用什么：工具变量。在这里，分配的处理就是一个完美的工具变量。它几乎是随机的，并且只通过实际处理才会影响应用内购买。</p>
</section>
<section id="late">
<h2>局部平均处理效应（LATE）<a class="headerlink" href="#late" title="Link to this heading">#</a></h2>
<p>局部平均处理效应明确指出了我们能够估计因果效应的群体。这也是理解工具变量（IV）的另一种方式，为我们提供了更多可用的直观见解。在现代工具变量理论中，我们将工具变量视为启动一条因果链：Z 导致 T，T 进而导致 Y。在此背景下，排他性约束意味着 Z 不会直接影响 Y，除非通过其对 T 的作用。第一阶段现在被视为 Z 对 T 的因果效应。我们还采用双重索引符号重写潜在结果，其中第一个索引表示工具变量的反事实情况，第二个索引则表示处理的反事实情况。</p>
<p><span class="math notranslate nohighlight">\(
\text{Potential Outcome}=\begin{cases}
Y_i(1, 1) \ \text{if } T_i=1, \ Z_i=1\\
Y_i(1, 0) \ \text{if } T_i=1, \ Z_i=0\\
Y_i(0, 1) \ \text{if } T_i=0, \ Z_i=1\\
Y_i(0, 0) \ \text{if } T_i=0, \ Z_i=0\\
\end{cases}
\)</span></p>
<p>从某种意义上说，在第一阶段中，处理变量变成了结果变量。这意味着我们也可以用潜在结果符号来表示它：</p>
<p><span class="math notranslate nohighlight">\(
\text{Potential Treatment}=\begin{cases}
T_0 \ \text{if } Z_i=0 \\
T_1 \ \text{if } Z_i=1
\end{cases}
\)</span></p>
<p><img alt="img" src="_images/double_index.png" /></p>
<p>工具变量假设现在可以重写如下：</p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(T_{0i}, T_{1i} \perp Z_i \)</span> 和 <span class="math notranslate nohighlight">\(Y_i(T_{1i},1), Y_i(T_{0i},0) \perp Z_i \)</span>。这是独立性假设。它表明工具变量如同随机分配一般有效。换句话说，工具变量 Z 与潜在处理无关，这意味着不同工具变量组的人群具有可比性。</p></li>
<li><p><span class="math notranslate nohighlight">\(Y_i(1, 0)=Y_i(1, 1)=Y_{i1}\)</span> 和 <span class="math notranslate nohighlight">\(Y_i(0, 0)=Y_i(0, 1)=Y_{i0}\)</span>。这是排他性约束。它指出，若考察接受处理者的潜在结果，两个工具变量组的结果是相同的。换言之，工具变量不影响潜在结果，即工具变量仅通过处理影响最终结果。</p></li>
<li><p><span class="math notranslate nohighlight">\(E[T_{1i}-T_{0i}] \neq 0\)</span>。这表示第一阶段的存在性。其含义是，第一阶段的潜在结果（即潜在处理）并不相同。换言之，工具变量确实对处理产生了影响。</p></li>
<li><p><span class="math notranslate nohighlight">\(T_{i1} &gt; T_{i0}\)</span>。这是单调性假设。其含义是，若对所有人启用工具变量，其处理水平将高于对所有人群禁用该工具变量时的处理水平。</p></li>
</ol>
<p>现在，让我们回顾一下沃尔德估计量，以进一步理解工具变量（IV）的直观含义：</p>
<p><span class="math notranslate nohighlight">\(
ATE = \dfrac{E[Y|Z=1]-E[Y|Z=0]}{E[T|Z=1]-E[T|Z=0]}
\)</span></p>
<p>首先，我们来看其中的第一部分，<span class="math notranslate nohighlight">\(E[Y|Z=1]\)</span>。利用排除限制条件，我们可以将 Y 用潜在结果的形式重写如下。</p>
<p><span class="math notranslate nohighlight">\(
E[Y_i|Z_i=1]=E[Y_{i0} + T_{i1}(Y_{i1} - Y_{i0})|Z=1]
\)</span></p>
<p>基于独立性假设，我们可以移除对 Z 的条件限制。</p>
<p><span class="math notranslate nohighlight">\(
E[Y_i|Z_i=1]=E[Y_{i0} + T_{i1}(Y_{i1} - Y_{i0})]
\)</span></p>
<p>通过类似的论证，我们得出</p>
<p><span class="math notranslate nohighlight">\(
E[Y_i|Z_i=0]=E[Y_{i0} + T_{i0}(Y_{i1} - Y_{i0})]
\)</span></p>
<p>我们现在可以将沃尔德估计量的分子部分重写如下</p>
<p><span class="math notranslate nohighlight">\(
E[Y|Z=1]-E[Y|Z=0] = E[(Y_{i1}-Y_{i0})(T_{i1}-T_{i0})]
\)</span></p>
<p>利用单调性，我们可知 <span class="math notranslate nohighlight">\(T_{i1}-T_{i0}\)</span> 为 0 或 1，因此</p>
<p><span class="math notranslate nohighlight">\(
E[(Y_{i1}-Y_{i0})(T_{i1}-T_{i0})] = E[(Y_{i1}-Y_{i0})|T_{i1}&gt;T_{i0}]P(T_{i1}&gt;T_{i0})
\)</span></p>
<p>采用类似方法处理分母部分，我们得到</p>
<p><span class="math notranslate nohighlight">\(
E[T|Z=1]-E[T|Z=0]=E[T_{i1}-T_{i0}]=P(T_{i1}&gt;T_{i0})
\)</span></p>
<p>综上所述，我们可以这样理解沃尔德估计量：</p>
<p><span class="math notranslate nohighlight">\(
ATE = \dfrac{E[(Y_{i1}-Y_{i0})|T_{i1}&gt;T_{i0}]P(T_{i1}&gt;T_{i0})}{P(T_{i1}&gt;T_{i0})}=E[(Y_{i1}-Y_{i0})|T_{i1}&gt;T_{i0}]
\)</span></p>
<p>也就是说，通过工具变量（IV）估计的平均处理效应（ATE）是在子群体 <span class="math notranslate nohighlight">\(T_{i1}&gt;T_{i0}\)</span> 上的 ATE。若从依从性角度考虑，这一子群体指代的是哪些人？这是指那些在工具开启时接受处理水平高于工具关闭时的群体。换言之，即依从者群体。为了便于记忆，</p>
<ol class="arabic simple">
<li><p>依从者意味着 <span class="math notranslate nohighlight">\(T_{i1}&gt;T_{i0}\)</span></p></li>
<li><p>永不接受者 <span class="math notranslate nohighlight">\(T_{i1}=T_{i0}=0\)</span></p></li>
<li><p>总是接受者 <span class="math notranslate nohighlight">\(T_{i1}=T_{i0}=1\)</span></p></li>
</ol>
<p>由此得出的结论是，工具变量(IV)对于永不接受者、总是接受者或违抗者的效应未提供任何信息，因为对于这些群体而言，处理状态并未改变！<strong>工具变量仅能识别出依从者的处理效应</strong>。</p>
</section>
<section id="id3">
<h2>对参与度的影响<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>让我们通过一个案例研究来观察这一切如何展开，该研究旨在评估推送通知对应用内购买的影响。因果图即为上文所展示的，此处不再重复。我们拥有的数据既包括随机分配的工具变量——推送通知的发送状态，也包括实际接收到的处理变量——推送通知的送达情况。</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">查看 Stata 代码</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">* Load data (assuming CSV is in current directory)</span>
import delimited <span class="s">&quot;./data/app_engagement_push.csv&quot;</span>,<span class="k"> clear</span>


<span class="k">list in</span> <span class="m">1</span><span class="o">/</span><span class="m">5</span>
</pre></div>
</div>
</div>
</details><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/app_engagement_push.csv&quot;</span><span class="p">)</span>
    
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>in_app_purchase</th>
      <th>push_assigned</th>
      <th>push_delivered</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>47</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>43</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>51</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>49</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>79</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>首先，我们运行普通最小二乘法（OLS）看看结果如何。</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">查看 Stata 代码</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">* Run OLS regression</span>
<span class="k">regress</span> in_app_purchase push_assigned push_delivered
</pre></div>
</div>
</div>
</details><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ols</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s2">&quot;in_app_purchase ~ 1 + push_assigned + push_delivered&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">ols</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Parameter Estimates</caption>
<tr>
         <td></td>        <th>Parameter</th> <th>Std. Err.</th> <th>T-stat</th>  <th>P-value</th> <th>Lower CI</th> <th>Upper CI</th>
</tr>
<tr>
  <th>Intercept</th>       <td>69.292</td>    <td>0.3624</td>   <td>191.22</td>  <td>0.0000</td>   <td>68.581</td>   <td>70.002</td> 
</tr>
<tr>
  <th>push_assigned</th>   <td>-17.441</td>   <td>0.5702</td>   <td>-30.590</td> <td>0.0000</td>   <td>-18.559</td>  <td>-16.324</td>
</tr>
<tr>
  <th>push_delivered</th>  <td>27.600</td>    <td>0.6124</td>   <td>45.069</td>  <td>0.0000</td>   <td>26.399</td>   <td>28.800</td> 
</tr>
</table></div></div>
</div>
<p>普通最小二乘法（OLS）显示处理效应为 27.60 巴西雷亚尔，即推送使应用内购买增加了 27.6 雷亚尔。然而，我们有理由认为这一估计存在偏误。已知旧款手机在接收推送时存在问题，因此更可能的是，拥有新款手机的较富裕用户构成了合规群体。由于接受处理的群体同时具备更高消费能力，我们认为这种偏误呈正向，推送的真实影响应低于当前估值。换言之，我们很可能面临 <span class="math notranslate nohighlight">\(E[Y_0|T=0] &lt; E[Y_0|T=1]\)</span> 的情况。</p>
<p>现在，让我们尝试用工具变量法来估计这一效应。首先，进行第一阶段回归分析。</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">查看 Stata 代码</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">* First-stage regression</span>
<span class="k">regress</span> push_delivered push_assigned
</pre></div>
</div>
</div>
</details><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">first_stage</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s2">&quot;push_delivered ~ 1 + push_assigned&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">first_stage</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Parameter Estimates</caption>
<tr>
        <td></td>        <th>Parameter</th> <th>Std. Err.</th>  <th>T-stat</th>   <th>P-value</th>  <th>Lower CI</th>  <th>Upper CI</th> 
</tr>
<tr>
  <th>Intercept</th>     <td>1.222e-16</td> <td>5.44e-11</td>  <td>2.246e-06</td> <td>1.0000</td>  <td>-1.066e-10</td> <td>1.066e-10</td>
</tr>
<tr>
  <th>push_assigned</th>  <td>0.7176</td>    <td>0.0064</td>    <td>112.07</td>   <td>0.0000</td>    <td>0.7050</td>    <td>0.7301</td>  
</tr>
</table></div></div>
</div>
<p>看起来我们的第一阶段效果显著。被分配到推送任务的群体中，有 71.8%确实接收到了推送。这意味着大约 28%的用户属于“永不接受者”。此外，我们有充分理由相信不存在“总是接受者”，因为截距参数估计值为零。这表明若未被分配推送任务，则无人会接收到推送。鉴于实验设计，这一结果在预期之中。</p>
<p>现在让我们运行缩减形式：</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">查看 Stata 代码</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">* Reduced form regression</span>
<span class="k">regress</span> in_app_purchase push_assigned
</pre></div>
</div>
</div>
</details><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_form</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s2">&quot;in_app_purchase ~ 1 + push_assigned&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">reduced_form</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Parameter Estimates</caption>
<tr>
        <td></td>        <th>Parameter</th> <th>Std. Err.</th> <th>T-stat</th> <th>P-value</th> <th>Lower CI</th> <th>Upper CI</th>
</tr>
<tr>
  <th>Intercept</th>      <td>69.292</td>    <td>0.3624</td>   <td>191.22</td> <td>0.0000</td>   <td>68.581</td>   <td>70.002</td> 
</tr>
<tr>
  <th>push_assigned</th>  <td>2.3636</td>    <td>0.5209</td>   <td>4.5376</td> <td>0.0000</td>   <td>1.3427</td>   <td>3.3845</td> 
</tr>
</table></div></div>
</div>
<p>缩减形式表明，处理分配的因果效应为 2.36。这意味着将某人分配到接收推送通知组，会使应用内购买增加 2.36 雷亚尔。</p>
<p>若将缩减形式除以前一阶段结果，我们通过处理单位的尺度调整工具变量的效应，得到 <span class="math notranslate nohighlight">\(2.3636/0.7176=3.29\)</span> 。运行两阶段最小二乘法(2SLS)后，我们获得了相同的估计值，并额外得到了正确的标准误。</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">查看 Stata 代码</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">* Run 2SLS regression (recommended approach)</span>
ivregress 2sls in_app_purchase (push_delivered = push_assigned)
</pre></div>
</div>
</div>
</details><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iv</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s2">&quot;in_app_purchase ~ 1 + [push_delivered ~ push_assigned]&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">iv</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Parameter Estimates</caption>
<tr>
         <td></td>        <th>Parameter</th> <th>Std. Err.</th> <th>T-stat</th> <th>P-value</th> <th>Lower CI</th> <th>Upper CI</th>
</tr>
<tr>
  <th>Intercept</th>       <td>69.292</td>    <td>0.3624</td>   <td>191.22</td> <td>0.0000</td>   <td>68.581</td>   <td>70.002</td> 
</tr>
<tr>
  <th>push_delivered</th>  <td>3.2938</td>    <td>0.7165</td>   <td>4.5974</td> <td>0.0000</td>   <td>1.8896</td>   <td>4.6981</td> 
</tr>
</table></div></div>
</div>
<p>这表明 2SLS 的结果远低于 OLS 估计值：3.29 对比 27.60。这是合理的，因为 OLS 估计的因果效应存在正向偏误。此外还需注意局部平均处理效应(LATE)。3.29 是依从者的平均因果效应。遗憾的是，我们无法对永不接受者做出任何推断。这意味着我们估计的是拥有较新手机的较富裕人群的效应。</p>
</section>
<section id="id4">
<h2>核心要点<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>在此，我们探讨了工具变量的一种更为现代的视角。我们了解到工具变量可被视为一条因果链，其中工具引发处理，处理进而影响结果。通过这一视角，我们考察了依从性以理解工具变量估计中的平均处理效应（ATE），并发现它实际上是依从者的局部平均处理效应（LATE）。</p>
</section>
<section id="id5">
<h2>参考文献<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>我愿将这一系列作品视为对 Joshua Angrist、Alberto Abadie 和 Christopher Walters 杰出计量经济学课程的致敬。第一部分的大部分思想源自他们在美国经济学会授课的内容。在艰难的 2020 年，正是观看他们的课程视频让我保持了理智。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.aeaweb.org/conference/cont-ed/2017-webcasts">Cross-Section Econometrics</a></p></li>
<li><p><a class="reference external" href="https://www.aeaweb.org/conference/cont-ed/2020-webcasts">Mastering Mostly Harmless Econometrics</a></p></li>
</ul>
<p>我还想引用 Angrist 的精彩著作。它们向我展示了计量经济学（他们称之为“Metrics”）不仅极为实用，而且充满乐趣。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.mostlyharmlesseconometrics.com">Mostly Harmless Econometrics</a></p></li>
<li><p><a class="reference external" href="https://www.masteringmetrics.com">Mastering ‘Metrics</a></p></li>
</ul>
<p>最后还要感谢 Miguel Hernán 和 Jamie Robins 的<a class="reference external" href="https://hsph.harvard.edu/profile/miguel-hernan/">《Causal Inference》</a>一书。它是我在面对最棘手的因果问题时的可靠伙伴。</p>
<p><img alt="img" src="_images/poetry.png" /></p>
</section>
<section id="id6">
<h2>参与贡献<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<p><strong>《Causal Inference for the Brave and True》</strong> 是一本关于因果推断的开源教材，致力于以经济上可负担、认知上可理解的方式，普及这门“科学的统计基础”。全书基于 Python，仅使用自由开源软件编写，原始英文版本由 <a class="reference external" href="https://github.com/matheusfacure">Matheus Facure</a> 编写与维护。</p>
<p>本书的中文版由黄文喆与许文立教授合作翻译，并托管在 <a class="reference external" href="https://github.com/Wenzhe-Huang/python-causality-handbook-zh">GitHub 中文主页</a>。希望本地化的内容能帮助更多中文读者学习和掌握因果推断方法。</p>
<p>如果你觉得这本书对你有帮助，并希望支持该项目，可以前往 <a class="reference external" href="https://www.patreon.com/causal_inference_for_the_brave_and_true">Patreon</a> 支持原作者。</p>
<p>如果你暂时不方便进行经济支持，也可以通过以下方式参与贡献：</p>
<ul class="simple">
<li><p>修正错别字</p></li>
<li><p>提出翻译或表达建议</p></li>
<li><p>反馈你未能理解的部分内容</p></li>
</ul>
<p>欢迎前往英文版或中文版仓库点击 <a class="reference external" href="https://github.com/matheusfacure/python-causality-handbook/issues">issues 区</a> 或 <a class="reference external" href="https://github.com/Wenzhe-Huang/python-causality-handbook-zh/issues">中文版 issues 区</a> 提出反馈。</p>
<p>最后，如果你喜欢这本书的内容，也请将其分享给可能感兴趣的朋友，并为项目在 GitHub 上点亮一颗星：<a class="reference external" href="https://github.com/matheusfacure/python-causality-handbook">英文版仓库</a> / <a class="reference external" href="https://github.com/Wenzhe-Huang/python-causality-handbook-zh">中文版仓库</a>。</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="08-Instrumental-Variables.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">08 - 工具变量</p>
      </div>
    </a>
    <a class="right-next"
       href="10-Matching.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">10 - 匹配法</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">初探异质性世界</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#late">局部平均处理效应（LATE）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">对参与度的影响</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">核心要点</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">参考文献</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">参与贡献</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Matheus Facure
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>